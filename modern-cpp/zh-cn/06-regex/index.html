

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>第 6 章 正则表达式 现代 C++ 教程: 高速上手 C++ 11/14/17/20 - Modern C++ Tutorial: C++ 11/14/17/20 On the Fly</title>
    <meta charset="utf-8">
    <meta name="description" content="Modern C++ Tutorial | C++ 11/14/17/20 On the Fly | 现代 C++ 教程 | 高速上手 C++11/14/17/20">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" type="image/x-icon" href="/modern-cpp/assets/cover-2nd.png">
    <meta name="msapplication-TileColor" content="#7e2d36">
    <meta name="theme-color" content="#7e2d36">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80889616-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-80889616-2');
    </script>

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles -->
    
<link rel="stylesheet" href="/modern-cpp/css/page.css">


    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script>window.PAGE_TYPE = "book-zh-cn"</script>
    <script async src="//changkun.de/urlstat/client.js"></script>
  <meta name="generator" content="Hexo 5.4.0"></head>
  <body class="docs">
	<!-- body开始 -->
    
      <div id="mobile-bar" data-bg-text="现代 C++ 教程" >
        <a class="menu-button"></a>
        <a class="logo" href="/modern-cpp/"></a>
      </div>
    
    <div id="header">
  <a id="logo" href="/modern-cpp/">
    
      <img src="/modern-cpp/assets/cover-2nd-logo.png">
      <span>现代 C++ 教程：高速上手 C++ 11/14/17/20</span>
    
  </a>
  <ul id="nav">
    
      <li class="nav-dropdown-container resource">
  <a class="nav-link">资源</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a class="nav-link" href="/modern-cpp/zh-cn/00-preface/" >正文</a></li>
      <!-- TODO -->
      <!-- <li><a class="nav-link" href="/modern-cpp/code/1/" >代码</a></li>
      <li><a class="nav-link" href="/modern-cpp/exercises/1/" >习题</a></li>
      <li><a class="nav-link" href="/modern-cpp/answers/1/" >答案</a></li> -->
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container about">
  <a class="nav-link">关于</a><span class="arrow"></span>
  <ul class="nav-dropdown">
      <li><ul>
      <li><a class="nav-link" href="/modern-cpp/about/donate.html" >资助</a></li>
      <li><a class="nav-link" href="/modern-cpp/about/copyright.html" >版权声明</a></li>
      <li><a class="nav-link" href="/modern-cpp/about/ack.html" >致谢</a></li>
      </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">
    <span style="content: url(/modern-cpp/assets/lang/cn.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
    中文
  </a><span class="arrow"></span>
  <ul class="nav-dropdown">
      <li><ul>
      <li><a class="nav-link" target="_blank" href="/modern-cpp/en-us/00-preface/">
        <span style="content: url(/modern-cpp/assets/lang/en.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
        English
      </a></li>
      </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container about">
  <a class="nav-link" target="_blank" rel="noopener" href="https://github.com/changkun/modern-cpp-tutorial">GitHub</a>
</li>


    
  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      
        <li class="nav-dropdown-container resource">
  <a class="nav-link">资源</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a class="nav-link" href="/modern-cpp/zh-cn/00-preface/" >正文</a></li>
      <!-- TODO -->
      <!-- <li><a class="nav-link" href="/modern-cpp/code/1/" >代码</a></li>
      <li><a class="nav-link" href="/modern-cpp/exercises/1/" >习题</a></li>
      <li><a class="nav-link" href="/modern-cpp/answers/1/" >答案</a></li> -->
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container about">
  <a class="nav-link">关于</a><span class="arrow"></span>
  <ul class="nav-dropdown">
      <li><ul>
      <li><a class="nav-link" href="/modern-cpp/about/donate.html" >资助</a></li>
      <li><a class="nav-link" href="/modern-cpp/about/copyright.html" >版权声明</a></li>
      <li><a class="nav-link" href="/modern-cpp/about/ack.html" >致谢</a></li>
      </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">
    <span style="content: url(/modern-cpp/assets/lang/cn.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
    中文
  </a><span class="arrow"></span>
  <ul class="nav-dropdown">
      <li><ul>
      <li><a class="nav-link" target="_blank" href="/modern-cpp/en-us/00-preface/">
        <span style="content: url(/modern-cpp/assets/lang/en.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
        English
      </a></li>
      </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container about">
  <a class="nav-link" target="_blank" rel="noopener" href="https://github.com/changkun/modern-cpp-tutorial">GitHub</a>
</li>


      
    </ul>
    <div class="list">
      <h2>
        
          正文
        
      </h2>
      <ul class="menu-root">
  
    <li>
      <a href="/modern-cpp/zh-cn/00-preface/index.html" class="sidebar-link">序言</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/01-intro/index.html" class="sidebar-link">第 1 章 迈向现代 C++</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/02-usability/index.html" class="sidebar-link">第 2 章 语言可用性的强化</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/03-runtime/index.html" class="sidebar-link">第 3 章 语言运行期的强化</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/04-containers/index.html" class="sidebar-link">第 4 章 容器</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/05-pointers/index.html" class="sidebar-link">第 5 章 智能指针与内存管理</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/06-regex/index.html" class="sidebar-link current">第 6 章 正则表达式</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/07-thread/index.html" class="sidebar-link">第 7 章 并行与并发</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/08-filesystem/index.html" class="sidebar-link">第 8 章 文件系统</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/09-others/index.html" class="sidebar-link">第 9 章 其他杂项</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/10-cpp20/index.html" class="sidebar-link">第 10 章 展望：C++20 简介</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/appendix1/index.html" class="sidebar-link">附录 1：进一步阅读的学习材料</a>
    </li>
  
    <li>
      <a href="/modern-cpp/zh-cn/appendix2/index.html" class="sidebar-link">附录 2：现代 C++ 的最佳实践</a>
    </li>
  
</ul>

    </div>
  </div>
</div>


<div class="content book-zh-cn with-sidebar index-guide">
  <h1 id="第-6-章-正则表达式"><a href="#第-6-章-正则表达式" class="headerlink" title="第 6 章 正则表达式"></a>第 6 章 正则表达式</h1><h2 id="6-1-正则表达式简介"><a href="#6-1-正则表达式简介" class="headerlink" title="6.1 正则表达式简介"></a>6.1 正则表达式简介</h2><p>正则表达式不是 C++ 语言的一部分，这里仅做简单的介绍。</p>
<p>正则表达式描述了一种字符串匹配的模式。一般使用正则表达式主要是实现下面三个需求：</p>
<ol>
<li>检查一个串是否包含某种形式的子串；</li>
<li>将匹配的子串替换；</li>
<li>从某个串中取出符合条件的子串。</li>
</ol>
<p>正则表达式是由普通字符（例如 a 到 z）以及特殊字符组成的文字模式。模式描述在搜索文本时要匹配的一个或多个字符串。
正则表达式作为一个模板，将某个字符模式与所搜索的字符串进行匹配。</p>
<h3 id="普通字符"><a href="#普通字符" class="headerlink" title="普通字符"></a>普通字符</h3><p>普通字符包括没有显式指定为元字符的所有可打印和不可打印字符。这包括所有大写和小写字母、所有数字、所有标点符号和一些其他符号。</p>
<h3 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h3><p>特殊字符是正则表达式里有特殊含义的字符，也是正则表达式的核心匹配语法。参见下表：</p>
<table>
<thead>
<tr>
<th align="center">特别字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>$</code></td>
<td align="left">匹配输入字符串的结尾位置。</td>
</tr>
<tr>
<td align="center"><code>(</code>,<code>)</code></td>
<td align="left">标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。</td>
</tr>
<tr>
<td align="center"><code>*</code></td>
<td align="left">匹配前面的子表达式零次或多次。</td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="left">匹配前面的子表达式一次或多次。</td>
</tr>
<tr>
<td align="center"><code>.</code></td>
<td align="left">匹配除换行符 <code>\n</code> 之外的任何单字符。</td>
</tr>
<tr>
<td align="center"><code>[</code></td>
<td align="left">标记一个中括号表达式的开始。</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="left">匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。</td>
</tr>
<tr>
<td align="center"><code>\</code></td>
<td align="left">将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， <code>n</code> 匹配字符 <code>n</code>。<code>\n</code> 匹配换行符。序列 <code>\\</code> 匹配 <code>&#39;\&#39;</code> 字符，而 <code>\(</code> 则匹配 <code>&#39;(&#39;</code> 字符。</td>
</tr>
<tr>
<td align="center"><code>^</code></td>
<td align="left">匹配输入字符串的开始位置，除非在方括号表达式中使用，此时它表示不接受该字符集合。</td>
</tr>
<tr>
<td align="center"><code>&#123;</code></td>
<td align="left">标记限定符表达式的开始。</td>
</tr>
<tr>
<td align="center"><code>|</code></td>
<td align="left">指明两项之间的一个选择。</td>
</tr>
</tbody></table>
<h3 id="限定符"><a href="#限定符" class="headerlink" title="限定符"></a>限定符</h3><p>限定符用来指定正则表达式的一个给定的组件必须要出现多少次才能满足匹配。见下表：</p>
<table>
<thead>
<tr>
<th align="center">字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>*</code></td>
<td align="left">匹配前面的子表达式零次或多次。例如，<code>foo*</code> 能匹配 <code>fo</code> 以及 <code>foooo</code>。<code>*</code> 等价于<code>&#123;0,&#125;</code>。</td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="left">匹配前面的子表达式一次或多次。例如，<code>foo+</code> 能匹配 <code>foo</code> 以及 <code>foooo</code>，但不能匹配 <code>fo</code>。<code>+</code> 等价于 <code>&#123;1,&#125;</code>。</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="left">匹配前面的子表达式零次或一次。例如，<code>Your(s)?</code> 可以匹配 <code>Your</code> 或 <code>Yours</code> 中的<code>Your</code> 。<code>?</code> 等价于 <code>&#123;0,1&#125;</code>。</td>
</tr>
<tr>
<td align="center"><code>&#123;n&#125;</code></td>
<td align="left"><code>n</code> 是一个非负整数。匹配确定的 <code>n</code> 次。例如，<code>o&#123;2&#125;</code> 不能匹配 <code>for</code> 中的 <code>o</code>，但是能匹配 <code>foo</code> 中的两个 <code>o</code>。</td>
</tr>
<tr>
<td align="center"><code>&#123;n,&#125;</code></td>
<td align="left"><code>n</code> 是一个非负整数。至少匹配 <code>n</code> 次。例如，<code>o&#123;2,&#125;</code> 不能匹配 <code>for</code> 中的 <code>o</code>，但能匹配 <code>foooooo</code> 中的所有 <code>o</code>。<code>o&#123;1,&#125;</code> 等价于 <code>o+</code>。<code>o&#123;0,&#125;</code> 则等价于 <code>o*</code>。</td>
</tr>
<tr>
<td align="center"><code>&#123;n,m&#125;</code></td>
<td align="left"><code>m</code> 和 <code>n</code> 均为非负整数，其中 <code>n</code> 小于等于 <code>m</code>。最少匹配 <code>n</code> 次且最多匹配 <code>m</code> 次。例如，<code>o&#123;1,3&#125;</code> 将匹配 <code>foooooo</code> 中的前三个 <code>o</code>。<code>o&#123;0,1&#125;</code> 等价于 <code>o?</code>。注意，在逗号和两个数之间不能有空格。</td>
</tr>
</tbody></table>
<p>有了这两张表，我们通常就能够读懂几乎所有的正则表达式了。</p>
<h2 id="6-2-std-regex-及其相关"><a href="#6-2-std-regex-及其相关" class="headerlink" title="6.2 std::regex 及其相关"></a>6.2 std::regex 及其相关</h2><p>对字符串内容进行匹配的最常见手段就是使用正则表达式。
可惜在传统 C++ 中正则表达式一直没有得到语言层面的支持，没有纳入标准库，
而 C++ 作为一门高性能语言，在后台服务的开发中，对 URL 资源链接进行判断时，
使用正则表达式也是工业界最为成熟的普遍做法。</p>
<p>一般的解决方案就是使用 <code>boost</code> 的正则表达式库。
而 C++11 正式将正则表达式的的处理方法纳入标准库的行列，从语言级上提供了标准的支持，
不再依赖第三方。</p>
<p>C++11 提供的正则表达式库操作 <code>std::string</code> 对象，
模式 <code>std::regex</code> (本质是 <code>std::basic_regex</code>)进行初始化，
通过 <code>std::regex_match</code> 进行匹配，
从而产生 <code>std::smatch</code> （本质是 <code>std::match_results</code> 对象）。</p>
<p>我们通过一个简单的例子来简单介绍这个库的使用。考虑下面的正则表达式:</p>
<ul>
<li><code>[a-z]+\.txt</code>: 在这个正则表达式中, <code>[a-z]</code> 表示匹配一个小写字母, <code>+</code> 可以使前面的表达式匹配多次，
因此 <code>[a-z]+</code> 能够匹配一个小写字母组成的字符串。
在正则表达式中一个 <code>.</code> 表示匹配任意字符，而 <code>\.</code> 则表示匹配字符 <code>.</code>，
最后的 <code>txt</code> 表示严格匹配 <code>txt</code> 则三个字母。因此这个正则表达式的所要匹配的内容就是由纯小写字母组成的文本文件。</li>
</ul>
<p><code>std::regex_match</code> 用于匹配字符串和正则表达式，有很多不同的重载形式。
最简单的一个形式就是传入 <code>std::string</code> 以及一个 <code>std::regex</code> 进行匹配，
当匹配成功时，会返回 <code>true</code>，否则返回 <code>false</code>。例如：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;regex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string fnames[] = &#123;<span class="string">&quot;foo.txt&quot;</span>, <span class="string">&quot;bar.txt&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;a0.txt&quot;</span>, <span class="string">&quot;AAA.txt&quot;</span>&#125;;</span><br><span class="line">    <span class="comment">// 在 C++ 中 \ 会被作为字符串内的转义符，</span></span><br><span class="line">    <span class="comment">// 为使 \. 作为正则表达式传递进去生效，需要对 \ 进行二次转义，从而有 \\.</span></span><br><span class="line">    <span class="function">std::regex <span class="title">txt_regex</span><span class="params">(<span class="string">&quot;[a-z]+\\.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;fname: fnames)</span><br><span class="line">        std::cout &lt;&lt; fname &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; std::<span class="built_in">regex_match</span>(fname, txt_regex) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一种常用的形式就是依次传入 <code>std::string</code>/<code>std::smatch</code>/<code>std::regex</code> 三个参数，
其中 <code>std::smatch</code> 的本质其实是 <code>std::match_results</code>。
故而在标准库的实现中， <code>std::smatch</code> 被定义为了 <code>std::match_results&lt;std::string::const_iterator&gt;</code>，
也就是一个子串迭代器类型的 <code>match_results</code>。
使用 <code>std::smatch</code> 可以方便的对匹配的结果进行获取，例如：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">std::regex <span class="title">base_regex</span><span class="params">(<span class="string">&quot;([a-z]+)\\.txt&quot;</span>)</span></span>;</span><br><span class="line">std::smatch base_match;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;fname: fnames) &#123;</span><br><span class="line">    <span class="keyword">if</span> (std::<span class="built_in">regex_match</span>(fname, base_match, base_regex)) &#123;</span><br><span class="line">        <span class="comment">// std::smatch 的第一个元素匹配整个字符串</span></span><br><span class="line">        <span class="comment">// std::smatch 的第二个元素匹配了第一个括号表达式</span></span><br><span class="line">        <span class="keyword">if</span> (base_match.<span class="built_in">size</span>() == <span class="number">2</span>) &#123;</span><br><span class="line">            std::string base = base_match[<span class="number">1</span>].<span class="built_in">str</span>();</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;sub-match[0]: &quot;</span> &lt;&lt; base_match[<span class="number">0</span>].<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line">            std::cout &lt;&lt; fname &lt;&lt; <span class="string">&quot; sub-match[1]: &quot;</span> &lt;&lt; base &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上两个代码段的输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">foo.txt: 1</span><br><span class="line">bar.txt: 1</span><br><span class="line">test: 0</span><br><span class="line">a0.txt: 0</span><br><span class="line">AAA.txt: 0</span><br><span class="line">sub-match[0]: foo.txt</span><br><span class="line">foo.txt sub-match[1]: foo</span><br><span class="line">sub-match[0]: bar.txt</span><br><span class="line">bar.txt sub-match[1]: bar</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本节简单介绍了正则表达式本身，然后根据使用正则表达式的主要需求，通过一个实际的例子介绍了正则表达式库的使用。</p>
<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><ol>
<li>在 Web 服务器开发中，我们通常希望服务某些满足某个条件的路由。正则表达式便是完成这一目标的工具之一。</li>
</ol>
<p>给定如下请求结构：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Request</span> &#123;</span></span><br><span class="line">    <span class="comment">// request method, POST, GET; path; HTTP version</span></span><br><span class="line">    std::string method, path, http_version;</span><br><span class="line">    <span class="comment">// use smart pointer for reference counting of content</span></span><br><span class="line">    std::shared_ptr&lt;std::istream&gt; content;</span><br><span class="line">    <span class="comment">// hash container, key-value dict</span></span><br><span class="line">    std::unordered_map&lt;std::string, std::string&gt; header;</span><br><span class="line">    <span class="comment">// use regular expression for path match</span></span><br><span class="line">    std::smatch path_match;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>请求的资源类型：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> std::map&lt;</span><br><span class="line">    std::string, std::unordered_map&lt;</span><br><span class="line">        std::string,std::function&lt;<span class="keyword">void</span>(std::ostream&amp;, Request&amp;)&gt;&gt;&gt; resource_type;</span><br></pre></td></tr></table></figure>

<p>以及服务端模板：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> socket_type&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerBase</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    resource_type resource;</span><br><span class="line">    resource_type default_resource;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function">Request <span class="title">parse_request</span><span class="params">(std::istream&amp; stream)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请实现成员函数 <code>start()</code> 与 <code>parse_request</code>。使得服务器模板使用者可以如下指定路由：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> SERVER_TYPE&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">start_server</span><span class="params">(SERVER_TYPE &amp;server)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// process GET request for /match/[digit+numbers], </span></span><br><span class="line">    <span class="comment">// e.g. GET request is /match/abc123, will return abc123</span></span><br><span class="line">    server.resource[<span class="string">&quot;fill_your_reg_ex&quot;</span>][<span class="string">&quot;GET&quot;</span>] = </span><br><span class="line">        [](ostream&amp; response, Request&amp; request) </span><br><span class="line">    &#123;</span><br><span class="line">        string number=request.path_match[<span class="number">1</span>];</span><br><span class="line">        response &lt;&lt; <span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Length: &quot;</span> </span><br><span class="line">                 &lt;&lt; number.<span class="built_in">length</span>() &lt;&lt; <span class="string">&quot;\r\n\r\n&quot;</span> &lt;&lt; number;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// peocess default GET request; </span></span><br><span class="line">    <span class="comment">// anonymous function will be called </span></span><br><span class="line">    <span class="comment">// if no other matches response files in folder web/</span></span><br><span class="line">    <span class="comment">// default: index.html</span></span><br><span class="line">    server.default_resource[<span class="string">&quot;fill_your_reg_ex&quot;</span>][<span class="string">&quot;GET&quot;</span>] = </span><br><span class="line">        [](ostream&amp; response, Request&amp; request) </span><br><span class="line">    &#123;</span><br><span class="line">        string filename = <span class="string">&quot;www/&quot;</span>;</span><br><span class="line"></span><br><span class="line">        string path = request.path_match[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// forbidden use `..` access content outside folder web/</span></span><br><span class="line">        <span class="keyword">size_t</span> last_pos = path.<span class="built_in">rfind</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">size_t</span> current_pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">size_t</span> pos;</span><br><span class="line">        <span class="keyword">while</span>((pos=path.<span class="built_in">find</span>(<span class="string">&#x27;.&#x27;</span>, current_pos)) != string::npos &amp;&amp; pos != last_pos) &#123;</span><br><span class="line">            current_pos = pos;</span><br><span class="line">            path.<span class="built_in">erase</span>(pos, <span class="number">1</span>);</span><br><span class="line">            last_pos--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (...)</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    server.<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考答案<a href="../../exercises/6">见此</a>。</p>
<h2 id="进一步阅读的参考资料"><a href="#进一步阅读的参考资料" class="headerlink" title="进一步阅读的参考资料"></a>进一步阅读的参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://zhihu.com/question/23070203/answer/84248248">知乎『如何评价 GCC 的 C++11 正则表达式？』中原库作者 Tim Shen 的回答</a></li>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/regex">正则表达式库文档</a></li>
</ol>

  <div class="guide-links">
    
      <span>← <a href="/modern-cpp/zh-cn/05-pointers/index.html">第 5 章 智能指针与内存管理</a></span>
    
    
      <span style="float: right;"><a href="/modern-cpp/zh-cn/07-thread/index.html">第 7 章 并行与并发</a> →</span>
    
  </div>

  
    <div class="footer">
        <p>
          <a href="https://changkun.de">欧长坤</a> &copy; 2016-2025 版权所有，
          采用<a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议许可</a>，代码使用 <a href="https://opensource.org/licenses/MIT" target="_blank">MIT</a> 协议开源。</a>
        </p>
        <p>
            如果你认为本书对你起到了帮助，可以<a href="/modern-cpp/about/donate.html">资助作者</a>。
        </p>
      </div>
  


</div>

      </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/smooth-scroll/10.2.1/js/smooth-scroll.min.js"></script>

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="https://cdn.jsdelivr.net/npm/css.escape@1.5.1/css.escape.min.js"></script>
    <script src="/modern-cpp/js/common.js"></script>

    <!-- fastclick -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>
