

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chapter 06 Regular Expression 现代 C++ 教程: 高速上手 C++ 11/14/17/20 - Modern C++ Tutorial: C++ 11/14/17/20 On the Fly</title>
    <meta charset="utf-8">
    <meta name="description" content="Modern C++ Tutorial | C++ 11/14/17/20 On the Fly | 现代 C++ 教程 | 高速上手 C++11/14/17/20">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" type="image/x-icon" href="/modern-cpp/assets/cover-2nd.png">
    <meta name="msapplication-TileColor" content="#7e2d36">
    <meta name="theme-color" content="#7e2d36">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-80889616-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-80889616-2');
    </script>

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles -->
    
<link rel="stylesheet" href="/modern-cpp/css/page.css">


    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script>window.PAGE_TYPE = "book-en-us"</script>
    <script async src="//changkun.de/urlstat/client.js"></script>
  <meta name="generator" content="Hexo 5.4.0"></head>
  <body class="docs">
	<!-- body开始 -->
    
      <div id="mobile-bar" data-bg-text="Modern C++ Tutorial" >
        <a class="menu-button"></a>
        <a class="logo" href="/modern-cpp/"></a>
      </div>
    
    <div id="header">
  <a id="logo" href="/modern-cpp/">
    
      <img src="/modern-cpp/assets/cover-2nd-en-logo.png">
      <span>Modern C++ Tutorial: C++ 11/14/17/20 On the Fly</span>
    
  </a>
  <ul id="nav">
    
      <li class="nav-dropdown-container resource">
<a class="nav-link">Resources</a><span class="arrow"></span>
<ul class="nav-dropdown">
    <li><ul>
    <li><a class="nav-link" href="/modern-cpp/en-us/00-preface/" >Book</a></li>
    <!-- TODO -->
    <!-- <li><a class="nav-link" href="/modern-cpp/code/1/" >Code</a></li>
    <li><a class="nav-link" href="/modern-cpp/exercises/1/" >Exercise</a></li>
    <li><a class="nav-link" href="/modern-cpp/answers/1/" >Answers</a></li> -->
    </ul></li>
</ul>
</li>

<li class="nav-dropdown-container about">
<a class="nav-link">About</a><span class="arrow"></span>
<ul class="nav-dropdown">
    <li><ul>
    <li><a class="nav-link" href="/modern-cpp/about/donate.html" >Donate</a></li>
    <li><a class="nav-link" href="/modern-cpp/about/copyright.html" >Copyright</a></li>
    <li><a class="nav-link" href="/modern-cpp/about/ack.html" >Acknowledgements</a></li>
    </ul></li>
</ul>
</li>

<li class="nav-dropdown-container language">
<a class="nav-link">
    <span style="content: url(/modern-cpp/assets/lang/en.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
    English
</a><span class="arrow"></span>
<ul class="nav-dropdown">
    <li><ul>
        <li><a class="nav-link" target="_blank" href="/modern-cpp/zh-cn/00-preface/">
        <span style="content: url(/modern-cpp/assets/lang/cn.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
        中文
    </a></li>
    </ul></li>
</ul>
</li>

<li class="nav-dropdown-container about">
<a class="nav-link" target="_blank" rel="noopener" href="https://github.com/changkun/modern-cpp-tutorial">GitHub</a>
</li>

    
  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      
        <li class="nav-dropdown-container resource">
<a class="nav-link">Resources</a><span class="arrow"></span>
<ul class="nav-dropdown">
    <li><ul>
    <li><a class="nav-link" href="/modern-cpp/en-us/00-preface/" >Book</a></li>
    <!-- TODO -->
    <!-- <li><a class="nav-link" href="/modern-cpp/code/1/" >Code</a></li>
    <li><a class="nav-link" href="/modern-cpp/exercises/1/" >Exercise</a></li>
    <li><a class="nav-link" href="/modern-cpp/answers/1/" >Answers</a></li> -->
    </ul></li>
</ul>
</li>

<li class="nav-dropdown-container about">
<a class="nav-link">About</a><span class="arrow"></span>
<ul class="nav-dropdown">
    <li><ul>
    <li><a class="nav-link" href="/modern-cpp/about/donate.html" >Donate</a></li>
    <li><a class="nav-link" href="/modern-cpp/about/copyright.html" >Copyright</a></li>
    <li><a class="nav-link" href="/modern-cpp/about/ack.html" >Acknowledgements</a></li>
    </ul></li>
</ul>
</li>

<li class="nav-dropdown-container language">
<a class="nav-link">
    <span style="content: url(/modern-cpp/assets/lang/en.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
    English
</a><span class="arrow"></span>
<ul class="nav-dropdown">
    <li><ul>
        <li><a class="nav-link" target="_blank" href="/modern-cpp/zh-cn/00-preface/">
        <span style="content: url(/modern-cpp/assets/lang/cn.svg); width: 15px; height: 15px; margin-right: 5px; vertical-align: middle; margin-bottom: 2px;"></span>
        中文
    </a></li>
    </ul></li>
</ul>
</li>

<li class="nav-dropdown-container about">
<a class="nav-link" target="_blank" rel="noopener" href="https://github.com/changkun/modern-cpp-tutorial">GitHub</a>
</li>

      
    </ul>
    <div class="list">
      <h2>
        
          Book-en-us
        
      </h2>
      <ul class="menu-root">
  
    <li>
      <a href="/modern-cpp/en-us/00-preface/index.html" class="sidebar-link">Preface</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/01-intro/index.html" class="sidebar-link">Chapter 01: Towards Modern C++</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/02-usability/index.html" class="sidebar-link">Chapter 02: Language Usability Enhancements</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/03-runtime/index.html" class="sidebar-link">Chapter 03: Language Runtime Enhancements</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/04-containers/index.html" class="sidebar-link">Chapter 04 Containers</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/05-pointers/index.html" class="sidebar-link">Chapter 05 Smart Pointers and Memory Management</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/06-regex/index.html" class="sidebar-link current">Chapter 06 Regular Expression</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/07-thread/index.html" class="sidebar-link">Chapter 07 Parallelism and Concurrency</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/08-filesystem/index.html" class="sidebar-link">Chapter 08 File System</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/09-others/index.html" class="sidebar-link">Chapter 09 Minor Features</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/10-cpp20/index.html" class="sidebar-link">Chapter 10 Outlook: Introduction of C++20</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/appendix1/index.html" class="sidebar-link">Appendix 1: Further Study Materials</a>
    </li>
  
    <li>
      <a href="/modern-cpp/en-us/appendix2/index.html" class="sidebar-link">Appendix 2: Modern C++ Best Practices</a>
    </li>
  
</ul>

    </div>
  </div>
</div>


<div class="content book-en-us with-sidebar index-guide">
  <h1 id="Chapter-06-Regular-Expression"><a href="#Chapter-06-Regular-Expression" class="headerlink" title="Chapter 06 Regular Expression"></a>Chapter 06 Regular Expression</h1><h2 id="6-1-Introduction"><a href="#6-1-Introduction" class="headerlink" title="6.1 Introduction"></a>6.1 Introduction</h2><p>Regular expressions are not part of the C++ language and therefore we only briefly
introduced it here.</p>
<p>Regular expressions describe a pattern of string matching.
The general use of regular expressions is mainly to achieve
the following three requirements:</p>
<ol>
<li>Check if a string contains some form of substring;</li>
<li>Replace the matching substrings;</li>
<li>Take the eligible substring from a string.</li>
</ol>
<p>Regular expressions are text patterns consisting of ordinary characters (such as a to z)
and special characters. A pattern describes one or more strings to match when searching for text.
Regular expressions act as a template to match a character pattern to the string being searched.</p>
<h3 id="Ordinary-characters"><a href="#Ordinary-characters" class="headerlink" title="Ordinary characters"></a>Ordinary characters</h3><p>Normal characters include all printable and unprintable characters that are not explicitly specified as metacharacters. This includes all uppercase
and lowercase letters, all numbers, all punctuation, and some other symbols.</p>
<h3 id="Special-characters"><a href="#Special-characters" class="headerlink" title="Special characters"></a>Special characters</h3><p>A special character is a character with special meaning in a regular expression and is also the core matching syntax of a regular expression. See the table below:</p>
<table>
<thead>
<tr>
<th align="center">Symbol</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>$</code></td>
<td align="left">Matches the end position of the input string.</td>
</tr>
<tr>
<td align="center"><code>(</code>,<code>)</code></td>
<td align="left">Marks the start and end of a subexpression. Subexpressions can be obtained for later use.</td>
</tr>
<tr>
<td align="center"><code>*</code></td>
<td align="left">Matches the previous subexpression zero or more times.</td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="left">Matches the previous subexpression one or more times.</td>
</tr>
<tr>
<td align="center"><code>.</code></td>
<td align="left">Matches any single character except the newline character <code>\n</code>.</td>
</tr>
<tr>
<td align="center"><code>[</code></td>
<td align="left">Marks the beginning of a bracket expression.</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="left">Matches the previous subexpression zero or one time, or indicates a non-greedy qualifier.</td>
</tr>
<tr>
<td align="center"><code>\</code></td>
<td align="left">Marks the next character as either a special character, or a literal character, or a backward reference, or an octal escape character. For example, <code>n</code> Matches the character <code>n</code>. <code>\n</code> matches newline characters. The sequence <code>\\</code> Matches the <code>&#39;\&#39;</code> character, while <code>\(</code> matches the <code>&#39;(&#39;</code> character.</td>
</tr>
<tr>
<td align="center"><code>^</code></td>
<td align="left">Matches the beginning of the input string, unless it is used in a square bracket expression, at which point it indicates that the set of characters is not accepted.</td>
</tr>
<tr>
<td align="center"><code>&#123;</code></td>
<td align="left">Marks the beginning of a qualifier expression.</td>
</tr>
<tr>
<td align="center"><code>|</code></td>
<td align="left">Indicates a choice between the two.</td>
</tr>
</tbody></table>
<h3 id="Quantifiers"><a href="#Quantifiers" class="headerlink" title="Quantifiers"></a>Quantifiers</h3><p>The qualifier is used to specify how many times a given component of a regular expression must appear to satisfy the match. See the table below:</p>
<table>
<thead>
<tr>
<th align="center">Symbol</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>*</code></td>
<td align="left">matches the previous subexpression zero or more times. For example, <code>foo*</code> matches <code>fo</code> and <code>foooo</code>. <code>*</code> is equivalent to <code>&#123;0,&#125;</code>.</td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="left">matches the previous subexpression one or more times. For example, <code>foo+</code> matches <code>foo</code> and <code>foooo</code> but does not match <code>fo</code>. <code>+</code> is equivalent to <code>&#123;1,&#125;</code>.</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="left">matches the previous subexpression zero or one time. For example, <code>Your(s)?</code> can match <code>Your</code> in <code>Your</code> or <code>Yours</code>. <code>?</code> is equivalent to <code>&#123;0,1&#125;</code>.</td>
</tr>
<tr>
<td align="center"><code>&#123;n&#125;</code></td>
<td align="left"><code>n</code> is a non-negative integer. Matches the determined <code>n</code> times. For example, <code>o&#123;2&#125;</code> cannot match <code>o</code> in <code>for</code>, but can match two <code>o</code> in <code>foo</code>.</td>
</tr>
<tr>
<td align="center"><code>&#123;n,&#125;</code></td>
<td align="left"><code>n</code> is a non-negative integer. Match at least <code>n</code> times. For example, <code>o&#123;2,&#125;</code> cannot match <code>o</code> in <code>for</code>, but matches all <code>o</code> in <code>foooooo</code>. <code>o&#123;1,&#125;</code> is equivalent to <code>o+</code>. <code>o&#123;0,&#125;</code> is equivalent to <code>o*</code>.</td>
</tr>
<tr>
<td align="center"><code>&#123;n,m&#125;</code></td>
<td align="left"><code>m</code> and <code>n</code> are non-negative integers, where <code>n</code> is less than or equal to <code>m</code>. Matches at least <code>n</code> times and matches up to <code>m</code> times. For example, <code>o&#123;1,3&#125;</code> will match the first three <code>o</code> in <code>foooooo</code>. <code>o&#123;0,1&#125;</code> is equivalent to <code>o?</code>. Note that there can be no spaces between the comma and the two numbers.</td>
</tr>
</tbody></table>
<p>With these two tables, we can usually read almost all regular expressions.</p>
<h2 id="6-2-std-regex-and-Its-Related"><a href="#6-2-std-regex-and-Its-Related" class="headerlink" title="6.2 std::regex and Its Related"></a>6.2 <code>std::regex</code> and Its Related</h2><p>The most common way to match string content is to use regular expressions. Unfortunately, in traditional C++, regular expressions have not been supported by the language level, and are not included in the standard library. C++ is a high-performance language. In the development of background services, the use of regular expressions is also used when judging URL resource links. The most mature and common practice in the industry.</p>
<p>The general solution is to use the regular expression library of <code>boost</code>. C++11 officially incorporates the processing of regular expressions into the standard library, providing standard support from the language level and no longer relying on third parties.</p>
<p>The regular expression library provided by C++11 operates on the <code>std::string</code> object, and the pattern <code>std::regex</code> (essentially <code>std::basic_regex</code>) is initialized and matched by <code>std::regex_match</code> Produces <code>std::smatch</code> (essentially the <code>std::match_results</code> object).</p>
<p>We use a simple example to briefly introduce the use of this library. Consider the following regular expression:</p>
<ul>
<li><code>[az]+\.txt</code>: In this regular expression, <code>[az]</code> means matching a lowercase letter, <code>+</code> can match the previous expression multiple times, so <code>[az]+</code> can Matches a string of lowercase letters. In the regular expression, a <code>.</code> means to match any character, and <code>\.</code> means to match the character <code>.</code>, and the last <code>txt</code> means to match <code>txt</code> exactly three letters. So the content of this regular expression to match is a text file consisting of pure lowercase letters.</li>
</ul>
<p><code>std::regex_match</code> is used to match strings and regular expressions, and there are many different overloaded forms. The simplest form is to pass <code>std::string</code> and a <code>std::regex</code> to match. When the match is successful, it will return <code>true</code>, otherwise, it will return <code>false</code>. For example:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;regex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string fnames[] = &#123;<span class="string">&quot;foo.txt&quot;</span>, <span class="string">&quot;bar.txt&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;a0.txt&quot;</span>, <span class="string">&quot;AAA.txt&quot;</span>&#125;;</span><br><span class="line">    <span class="comment">// In C++, `\` will be used as an escape character in the string.</span></span><br><span class="line">    <span class="comment">// In order for `\.` to be passed as a regular expression,</span></span><br><span class="line">    <span class="comment">// it is necessary to perform second escaping of `\`, thus we have `\\.`</span></span><br><span class="line">    <span class="function">std::regex <span class="title">txt_regex</span><span class="params">(<span class="string">&quot;[a-z]+\\.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;fname: fnames)</span><br><span class="line">        std::cout &lt;&lt; fname &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; std::<span class="built_in">regex_match</span>(fname, txt_regex) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another common form is to pass in the three arguments <code>std::string</code>/<code>std::smatch</code>/<code>std::regex</code>.
The essence of <code>std::smatch</code> is actually <code>std::match_results</code>.
In the standard library, <code>std::smatch</code> is defined as <code>std::match_results&lt;std::string::const_iterator&gt;</code>,
which means <code>match_results</code> of a substring iterator type.
Use <code>std::smatch</code> to easily get the matching results, for example:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">std::regex <span class="title">base_regex</span><span class="params">(<span class="string">&quot;([a-z]+)\\.txt&quot;</span>)</span></span>;</span><br><span class="line">std::smatch base_match;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;fname: fnames) &#123;</span><br><span class="line">    <span class="keyword">if</span> (std::<span class="built_in">regex_match</span>(fname, base_match, base_regex)) &#123;</span><br><span class="line">        <span class="comment">// the first element of std::smatch matches the entire string</span></span><br><span class="line">        <span class="comment">// the second element of std::smatch matches the first expression</span></span><br><span class="line">        <span class="comment">// with brackets</span></span><br><span class="line">        <span class="keyword">if</span> (base_match.<span class="built_in">size</span>() == <span class="number">2</span>) &#123;</span><br><span class="line">            std::string base = base_match[<span class="number">1</span>].<span class="built_in">str</span>();</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;sub-match[0]: &quot;</span> &lt;&lt; base_match[<span class="number">0</span>].<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line">            std::cout &lt;&lt; fname &lt;&lt; <span class="string">&quot; sub-match[1]: &quot;</span> &lt;&lt; base &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The output of the above two code snippets is:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">foo.txt: 1</span><br><span class="line">bar.txt: 1</span><br><span class="line">test: 0</span><br><span class="line">a0.txt: 0</span><br><span class="line">AAA.txt: 0</span><br><span class="line">sub-match[0]: foo.txt</span><br><span class="line">foo.txt sub-match[1]: foo</span><br><span class="line">sub-match[0]: bar.txt</span><br><span class="line">bar.txt sub-match[1]: bar</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This section briefly introduces the regular expression itself,
and then introduces the use of the regular expression library
through a practical example based on the main requirements of
using regular expressions.</p>
<h2 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h2><p>In web server development, we usually want to serve some routes that satisfy a certain condition.
Regular expressions are one of the tools to accomplish this.
Given the following request structure:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Request</span> &#123;</span></span><br><span class="line">    <span class="comment">// request method, POST, GET; path; HTTP version</span></span><br><span class="line">    std::string method, path, http_version;</span><br><span class="line">    <span class="comment">// use smart pointer for reference counting of content</span></span><br><span class="line">    std::shared_ptr&lt;std::istream&gt; content;</span><br><span class="line">    <span class="comment">// hash container, key-value dict</span></span><br><span class="line">    std::unordered_map&lt;std::string, std::string&gt; header;</span><br><span class="line">    <span class="comment">// use regular expression for path match</span></span><br><span class="line">    std::smatch path_match;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Requested resource type:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> std::map&lt;</span><br><span class="line">    std::string, std::unordered_map&lt;</span><br><span class="line">        std::string,std::function&lt;<span class="keyword">void</span>(std::ostream&amp;, Request&amp;)&gt;&gt;&gt; resource_type;</span><br></pre></td></tr></table></figure>

<p>And server template:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> socket_type&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerBase</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    resource_type resource;</span><br><span class="line">    resource_type default_resource;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function">Request <span class="title">parse_request</span><span class="params">(std::istream&amp; stream)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Please implement the member functions <code>start()</code> and <code>parse_request</code>. Enable server template users to specify routes as follows:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> SERVER_TYPE&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">start_server</span><span class="params">(SERVER_TYPE &amp;server)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// process GET request for /match/[digit+numbers],</span></span><br><span class="line">    <span class="comment">// e.g. GET request is /match/abc123, will return abc123</span></span><br><span class="line">    server.resource[<span class="string">&quot;fill_your_reg_ex&quot;</span>][<span class="string">&quot;GET&quot;</span>] =</span><br><span class="line">        [](ostream&amp; response, Request&amp; request)</span><br><span class="line">    &#123;</span><br><span class="line">        string number=request.path_match[<span class="number">1</span>];</span><br><span class="line">        response &lt;&lt; <span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Length: &quot;</span> &lt;&lt; number.<span class="built_in">length</span>()</span><br><span class="line">            &lt;&lt; <span class="string">&quot;\r\n\r\n&quot;</span> &lt;&lt; number;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// peocess default GET request;</span></span><br><span class="line">    <span class="comment">// anonymous function will be called</span></span><br><span class="line">    <span class="comment">// if no other matches response files in folder web/</span></span><br><span class="line">    <span class="comment">// default: index.html</span></span><br><span class="line">    server.default_resource[<span class="string">&quot;fill_your_reg_ex&quot;</span>][<span class="string">&quot;GET&quot;</span>] =</span><br><span class="line">        [](ostream&amp; response, Request&amp; request)</span><br><span class="line">    &#123;</span><br><span class="line">        string filename = <span class="string">&quot;www/&quot;</span>;</span><br><span class="line"></span><br><span class="line">        string path = request.path_match[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// forbidden use `..` access content outside folder web/</span></span><br><span class="line">        <span class="keyword">size_t</span> last_pos = path.<span class="built_in">rfind</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">size_t</span> current_pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">size_t</span> pos;</span><br><span class="line">        <span class="keyword">while</span>((pos=path.<span class="built_in">find</span>(<span class="string">&#x27;.&#x27;</span>, current_pos)) != string::npos &amp;&amp; pos != last_pos) &#123;</span><br><span class="line">            current_pos = pos;</span><br><span class="line">            path.<span class="built_in">erase</span>(pos, <span class="number">1</span>);</span><br><span class="line">            last_pos--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (...)</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    server.<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>An suggested solution can be found <a href="../../exercises/6">here</a>.</p>
<h2 id="Further-Readings"><a href="#Further-Readings" class="headerlink" title="Further Readings"></a>Further Readings</h2><ol>
<li><a target="_blank" rel="noopener" href="https://zhihu.com/question/23070203/answer/84248248">Comments from <code>std::regex</code>&#39;s author</a></li>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/regex">Library document of Regular Expression</a></li>
</ol>

  <div class="guide-links">
    
      <span>← <a href="/modern-cpp/en-us/05-pointers/index.html">Chapter 05 Smart Pointers and Memory Management</a></span>
    
    
      <span style="float: right;"><a href="/modern-cpp/en-us/07-thread/index.html">Chapter 07 Parallelism and Concurrency</a> →</span>
    
  </div>

  
    <div class="footer">
        <p>
          <a href="https://changkun.de">Changkun Ou</a> &copy; 2016-2025.
          The book is licensed under <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0</a>, code is open sourced under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT</a> License. </a>
        </p>
        <p>
          If you like the book, you could <a href="/modern-cpp/about/donate.html">donate the author</a>.
        </p>
      </div>
  


</div>

      </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/smooth-scroll/10.2.1/js/smooth-scroll.min.js"></script>

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="https://cdn.jsdelivr.net/npm/css.escape@1.5.1/css.escape.min.js"></script>
    <script src="/modern-cpp/js/common.js"></script>

    <!-- fastclick -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>
